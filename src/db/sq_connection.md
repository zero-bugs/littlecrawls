Jpbi9weXRob24zCiMgLSotIGNvZGluZzogVVRGLTggLSotCgppbXBvcnQgc3FsaXRlMwppbXBvcnQgdGhyZWFkaW5nCgpmcm9tIHNyYy5jb21tb24uY29tbW9uX2NvbmZpZyBpbXBvcnQgQ29tbW9uQ29uc3RhbnQKZnJvbSBzcmMuY29tbW9uLmRiX3NxbCBpbXBvcnQgY3JlYXRlX2ltZ190YWJsZSwgaW5zZXJ0X2ltZ19zcWwsIHNlbGVjdF9pbWdfc3FsLCBpbnNlcnRfY29tbW9uX3NxbCwgc2VsZWN0X2NvbW1vbl9zcWwsIFwKICAgIGRlbF9jb21tb25fc3FsLCBjcmVhdGVfcGFyYV90YWJsZQpmcm9tIHNyYy5tb2RlbC5pbWdfYXR0cmliIGltcG9ydCBXYWxsUGljQXR0cgoKCmNsYXNzIFNxbGl0ZU1hbmFnZXI6CiAgICBfaW5zdGFuY2VfbG9jayA9IHRocmVhZGluZy5Mb2NrKCkKCiAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKToKICAgICAgICAjIOmTvuaOpeaVsOaNruW6k++8jOiLpeaVsOaNruW6k+S4jeWtmOWcqOWImeWIm+W7ugogICAgICAgIHNlbGYuY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgKICAgICAgICAgICAgIiVzIiAlIENvbW1vbkNvbnN0YW50LmRiX2xpYl9wYXRoLCBjaGVja19zYW1lX3RocmVhZD1GYWxzZQogICAgICAgICkKICAgICAgICAjIOWcqOWGheWtmOS4reWIm+W7uuaVsOaNruW6kwogICAgICAgICMgY29ubiA9IHNxbGl0ZTMuY29ubmVjdCgiOm1lbW9yeToiKQogICAgICAgICMg5Yib5bu65ri45qCH5a+56LGhCiAgICAgICAgc2VsZi5jdXIgPSBzZWxmLmNvbm4uY3Vyc29yKCkKCiAgICAgICAgIyDliJvlu7rmlbDmja7ooagKICAgICAgICBzZWxmLmN1ci5leGVjdXRlKGNyZWF0ZV9wYXJhX3RhYmxlKQogICAgICAgIHNlbGYuY3VyLmV4ZWN1dGUoY3JlYXRlX2ltZ190YWJsZSkKCiAgICBAY2xhc3NtZXRob2QKICAgIGRlZiBpbnN0YW5jZShjbHMsICphcmdzLCAqKmt3YXJncyk6CiAgICAgICAgaWYgbm90IGhhc2F0dHIoU3FsaXRlTWFuYWdlciwgIl9pbnN0YW5jZSIpOgogICAgICAgICAgICB3aXRoIFNxbGl0ZU1hbmFnZXIuX2luc3RhbmNlX2xvY2s6CiAgICAgICAgICAgICAgICBpZiBub3QgaGFzYXR0cihTcWxpdGVNYW5hZ2VyLCAiX2luc3RhbmNlIik6CiAgICAgICAgICAgICAgICAgICAgU3FsaXRlTWFuYWdlci5faW5zdGFuY2UgPSBTcWxpdGVNYW5hZ2VyKCphcmdzLCAqKmt3YXJncykKICAgICAgICByZXR1cm4gU3FsaXRlTWFuYWdlci5faW5zdGFuY2UKCiAgICBkZWYgaW5zZXJ0X2ltZyhzZWxmLCBwaWM6IFdhbGxQaWNBdHRyKToKICAgICAgICBpZiBwaWMgaXMgTm9uZToKICAgICAgICAgICAgcmV0dXJuIEZhbHNlCgogICAgICAgIHRyeToKICAgICAgICAgICAgbG9jay5hY3F1aXJlKFRydWUpCiAgICAgICAgICAgIHNlbGYuY3VyLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICBpbnNlcnRfaW1nX3NxbCwKICAgICAgICAgICAgICAgICgKICAgICAgICAgICAgICAgICAgICBwaWMuaWQsCiAgICAgICAgICAgICAgICAgICAgcGljLnVybCwKICAgICAgICAgICAgICAgICAgICBwaWMudmlld3MsCiAgICAgICAgICAgICAgICAgICAgcGljLmZhdm9yaXRlcywKICAgICAgICAgICAgICAgICAgICBwaWMuc291cmNlLAogICAgICAgICAgICAgICAgICAgIHBpYy5wdXJpdHksCiAgICAgICAgICAgICAgICAgICAgcGljLmNhdGVnb3J5LAogICAgICAgICAgICAgICAgICAgIHBpYy5kaW1lbnNpb25feCwKICAgICAgICAgICAgICAgICAgICBwaWMuZGltZW5zaW9uX3ksCiAgICAgICAgICAgICAgICAgICAgcGljLnJhdGlvLAogICAgICAgICAgICAgICAgICAgIHBpYy5maWxlX3NpemUsCiAgICAgICAgICAgICAgICAgICAgcGljLmZpbGVfdHlwZSwKICAgICAgICAgICAgICAgICAgICBwaWMucGF0aCwKICAgICAgICAgICAgICAgICAgICBwaWMuY29sb3JzLAogICAgICAgICAgICAgICAgICAgIHBpYy50YWdzLAogICAgICAgICAgICAgICAgICAgIHBpYy5jcmVhdGVkX3RpbWUsCiAgICAgICAgICAgICAgICAgICAgcGljLmNyZWF0ZV9hdCwKICAgICAgICAgICAgICAgICAgICBwaWMudXBkYXRlX2F0LAogICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgKQogICAgICAgICAgICBzZWxmLmNvbm4uY29tbWl0KCkKICAgICAgICAgICAgcmV0dXJuIFRydWUKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGVycjoKICAgICAgICAgICAgcHJpbnQoZXJyKQogICAgICAgICAgICBzZWxmLmNvbm4ucm9sbGJhY2soKQogICAgICAgICAgICByZXR1cm4gRmFsc2UKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICBsb2NrLnJlbGVhc2UoKQoKICAgIGRlZiBiYXRjaEluc2VydEltZyhzZWxmLCBwaWNzOiBsaXN0KToKICAgICAgICBpZiBwaWNzIGlzIE5vbmU6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGVsaWYgbGVuKHBpY3MpID09IDA6CiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIHRyeToKICAgICAgICAgICAgbG9jay5hY3F1aXJlKFRydWUpCiAgICAgICAgICAgIGZvciBwaWMgaW4gcGljczoKICAgICAgICAgICAgICAgIHNlbGYuY3VyLmV4ZWN1dGUoCiAgICAgICAgICAgICAgICAgICAgaW5zZXJ0X2ltZ19zcWwsCiAgICAgICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgICAgICBwaWMuaWQsCiAgICAgICAgICAgICAgICAgICAgICAgIHBpYy51cmwsCiAgICAgICAgICAgICAgICAgICAgICAgIHBpYy52aWV3cywKICAgICAgICAgICAgICAgICAgICAgICAgcGljLmZhdm9yaXRlcywKICAgICAgICAgICAgICAgICAgICAgICAgcGljLnNvdXJjZSwKICAgICAgICAgICAgICAgICAgICAgICAgcGljLnB1cml0eSwKICAgICAgICAgICAgICAgICAgICAgICAgcGljLmNhdGVnb3J5LAogICAgICAgICAgICAgICAgICAgICAgICBwaWMuZGltZW5zaW9uX3gsCiAgICAgICAgICAgICAgICAgICAgICAgIHBpYy5kaW1lbnNpb25feSwKICAgICAgICAgICAgICAgICAgICAgICAgcGljLnJhdGlvLAogICAgICAgICAgICAgICAgICAgICAgICBwaWMuZmlsZV9zaXplLAogICAgICAgICAgICAgICAgICAgICAgICBwaWMuZmlsZV90eXBlLAogICAgICAgICAgICAgICAgICAgICAgICBwaWMucGF0aCwKICAgICAgICAgICAgICAgICAgICAgICAgcGljLmNvbG9ycywKICAgICAgICAgICAgICAgICAgICAgICAgcGljLnRhZ3MsCiAgICAgICAgICAgICAgICAgICAgICAgIHBpYy5jcmVhdGVkX3RpbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHBpYy5jcmVhdGVfYXQsCiAgICAgICAgICAgICAgICAgICAgICAgIHBpYy51cGRhdGVfYXQsCiAgICAgICAgICAgICAgICAgICAgKSwKICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgZWxzZToKICAgICAgICAgICAgICAgIHNlbGYuY29ubi5jb21taXQoKQogICAgICAgICAgICByZXR1cm4gVHJ1ZQogICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZXJyOgogICAgICAgICAgICBwcmludChlcnIpCiAgICAgICAgICAgIHNlbGYuY29ubi5yb2xsYmFjaygpCiAgICAgICAgICAgIHJldHVybiBGYWxzZQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGxvY2sucmVsZWFzZSgpCgogICAgZGVmIHNlbGVjdEltZ3Moc2VsZiwgbGltaXQ9MTAwLCBvZmZzZXQ9MCk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2NrLmFjcXVpcmUoVHJ1ZSkKICAgICAgICAgICAgc2VsZi5jdXIuZXhlY3V0ZSgKICAgICAgICAgICAgICAgIHNlbGVjdF9pbWdfc3FsLAogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgIGxpbWl0LAogICAgICAgICAgICAgICAgICAgIG9mZnNldCwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICAgICAgcmV0dXJuIHNlbGYuY3VyLmZldGNoYWxsKCkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGVycjoKICAgICAgICAgICAgcHJpbnQoZXJyKQogICAgICAgICAgICBzZWxmLmNvbm4ucm9sbGJhY2soKQogICAgICAgICAgICByZXR1cm4gTm9uZQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGxvY2sucmVsZWFzZSgpCgogICAgZGVmIGluc2VydF9jb21tb25fdGIoc2VsZiwga2V5LCB2YWx1ZSwgZGVzY3JpcHRpb249J2N1cnJlbnQgY29va2llJyk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2NrLmFjcXVpcmUoVHJ1ZSkKICAgICAgICAgICAgc2VsZi5jdXIuZXhlY3V0ZSgKICAgICAgICAgICAgICAgIGluc2VydF9jb21tb25fc3FsLAogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgIGtleSwKICAgICAgICAgICAgICAgICAgICB2YWx1ZSwKICAgICAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbiwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGVycjoKICAgICAgICAgICAgcHJpbnQoZXJyKQogICAgICAgICAgICBzZWxmLmNvbm4ucm9sbGJhY2soKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGxvY2sucmVsZWFzZSgpCgogICAgZGVmIHNlbGVjdF9jb21tb25fdGIoc2VsZiwga2V5KToKICAgICAgICB0cnk6CiAgICAgICAgICAgIGxvY2suYWNxdWlyZShUcnVlKQogICAgICAgICAgICBzZWxmLmN1ci5leGVjdXRlKAogICAgICAgICAgICAgICAgc2VsZWN0X2NvbW1vbl9zcWwsCiAgICAgICAgICAgICAgICAoCiAgICAgICAgICAgICAgICAgICAga2V5CiAgICAgICAgICAgICAgICApLAogICAgICAgICAgICApCiAgICAgICAgICAgIHJldHVybiBzZWxmLmN1ci5mZXRjaGFsbCgpCiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlcnI6CiAgICAgICAgICAgIHByaW50KGVycikKICAgICAgICAgICAgc2VsZi5jb25uLnJvbGxiYWNrKCkKICAgICAgICBmaW5hbGx5OgogICAgICAgICAgICBsb2NrLnJlbGVhc2UoKQogICAgICAgIHJldHVybiBOb25lCgogICAgZGVmIGRlbF9jb21tb25fdGIoc2VsZiwgaW5kZXgsIGtleSk6CiAgICAgICAgdHJ5OgogICAgICAgICAgICBsb2NrLmFjcXVpcmUoVHJ1ZSkKICAgICAgICAgICAgc2VsZi5jdXIuZXhlY3V0ZSgKICAgICAgICAgICAgICAgIGRlbF9jb21tb25fc3FsLAogICAgICAgICAgICAgICAgKAogICAgICAgICAgICAgICAgICAgIGluZGV4LAogICAgICAgICAgICAgICAgICAgIGtleSwKICAgICAgICAgICAgICAgICksCiAgICAgICAgICAgICkKICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGVycjoKICAgICAgICAgICAgcHJpbnQoZXJyKQogICAgICAgICAgICBzZWxmLmNvbm4ucm9sbGJhY2soKQogICAgICAgIGZpbmFsbHk6CiAgICAgICAgICAgIGxvY2sucmVsZWFzZSgpCiAgICAgICAgcmV0dXJuIE5vbmUKCiAgICBkZWYgY2xvc2Uoc2VsZik6CiAgICAgICAgc2VsZi5jdXIuY2xvc2UoKQogICAgICAgIHNlbGYuY29ubi5jbG9zZSgpCgogICAgZGVmIGNvbW1pdChzZWxmKToKICAgICAgICBzZWxmLmNvbm4uY29tbWl0KCkKCgpzcWxpdGVNYW5hZ2VyID0gU3FsaXRlTWFuYWdlcigpCmxvY2sgPSB0aHJlYWRpbmcuTG9jaygpCgIyEvdXNyL2
